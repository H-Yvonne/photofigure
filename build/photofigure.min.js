!function(a,b,c){"function"==typeof define&&(define.cmd||define.amd)?define(function(){return c(a,b)}):a.photofigure=c(a,b)}(window,$,function(a,b){var c=b(window),d=b("html"),e=b("body"),f={_handlers:"",on:function(a,b){return"object"!=typeof this._handlers&&(this._handlers=[]),this._handlers[a]||(this._handlers[a]=[]),"function"==typeof b&&this._handlers[a].push(b),this},emit:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this._handlers[a]||[],d=0,e=c.length;e>d;d++)c[d].apply(null,b);return this}},g=function(a){this.imgData=[],this.init(a)};b.extend(g.prototype,f,{init:function(a){var b=this.filterData(a);this.imgData=this.imgData.concat(b),this._renderWarp()},filterData:function(a){var c=[];return b.isArray(a)?c=c.concat(a):"object"==typeof a&&c.push(a),c}}),b.extend(g.prototype,{$_warp:"",$_figbox:"",_renderWarp:function(){var a='<div class="photo_figure_layer">						<div class="photo_bg_layer"></div>							<div class="photo_figure_main">								<a href="javascript:;" class="closebtn"><em class="pficon"></em></a>								<div class="photo_figure_box"></div>							</div>					</div>';this._setHidden();var c=b(a);d.append(c),this.$_warp=c,this.$_figbox=c.find(".photo_figure_box"),this._warpControl(),this._renderPhotoShow(),this._renderGallary()},_setHidden:function(){e.css({overflow:"hidden"})},_setVisible:function(){e.css({overflow:"visible"})},_warpControl:function(){var a=this;this.$_warp.on("click","a.closebtn",function(){a._setVisible(),a.$_warp.remove()})}}),b.extend(g.prototype,{$_photoshow:"",_mainImg:"",_renderPhotoShow:function(){var a='<div class="photo_figure_showwarp">						<div class="photo_figure_iwarp" node-type="img-home"></div>						<a href="javascript:;" class="btn btn_left">							<em class="pficon arr_l"></em>						</a>						<a href="javascript:;" class="btn btn_right"><em class="pficon arr_r"></em></a>						<div class="photo_figure_zr">							<a href="javascript:;" class="photo_opbtn" node-type="rotate"><em class="pficon rotate"></em></a>							<a href="javascript:;" class="photo_opbtn" node-type="zoom" style="display:none;">								<em class="pficon zoom"></em>							</a>						</div>					</div>';this._setHidden();var c=b(a);this.$_photoshow=c,this.$_figbox.append(c),this._showControl()},_showControl:function(){var a=this;this.$_photoshow.on("click","a.btn_left",function(){a.imgListObj.pre()}).on("click","a.btn_right",function(){a.imgListObj.next()}).on("click",'a[node-type="rotate"]',function(){a._mainImg&&a._mainImg.rotate.clockwise()})},_showMainImage:function(a){this._mainImg=new j(a,this)}}),b.extend(g.prototype,{$_gallary:"",$_viewwarp:"",$ul:"",imgListObj:"",_imglist:[],_renderGallary:function(){var a='<div class="photo_gallary">						<div class="pf_iw" node-type="imgview_warp">							<ul class="galllist clearfix"></ul>						</div>						<div class="gall_btn gall_btn_l">							<a href="javascript:;" class="btn" node-type="btn-l"><em class="pficon l"></em></a>						</div>						<div class="gall_btn gall_btn_r">							<a href="javascript:;" class="btn" node-type="btn-r"><em class="pficon r"></em></a>						</div>					</div>',c=b(a);this.$_gallary=c,this.$_viewwarp=c.find('div[node-type="imgview_warp"]'),this.$ul=c.find("ul"),this.$_figbox.append(c),this._gallaryControl()},add:function(a){if(this.imgListObj){var b=this.filterData(a);this.imgListObj.add(b)}},_gallaryControl:function(){this._gallary_showimg()},_gallary_showimg:function(){var a=this;this.imgListObj=new h,this.imgListObj.on("add",function(b){var c=new i(b),d=c.render();a.$_gallary.find("ul.galllist").append(d),a._imglist.push(c),c.on("click",function(b){a.imgListObj.setCurrent(b.data.cindex)})}).on("pre",function(b){a._gallary_setFocus(b)}).on("next",function(b){a._gallary_setFocus(b)}).on("current",function(b){a._gallary_setFocus(b)}),this.$_gallary.on("click",'a[node-type="btn-l"]',function(){a.imgListObj.pre()}).on("click",'a[node-type="btn-r"]',function(){a.imgListObj.next()}),this.imgListObj.add(this.imgData),this._gallary_setFocus(this.imgListObj.currIndex)},_gallary_emititem:function(a){this._gallary_setFocus(a.data.cindex)},_gallary_setFocus:function(a){for(var b=this._imglist,c=0,d=b.length;d>c;c++)b[c].cancelCurrent();b[a].setCurrent(),this._showMainImage(b[a].data),this._slideImgView(a)},_slideImgView:function(a){var b=131,c=Math.floor(this.$_viewwarp.width()/b),d=this._imglist.length;if(!(c>d)){var e=Math.floor(a/c),f=e*c,g=(e+1)*c;g>d&&(g=d,f=f-g+d),this.$ul.animate({"margin-left":-(f*(b+10))},200)}}});var h=function(a){this.dataList=[],this.currIndex=0,this.cindex=0;var b=this;b.add(a)};b.extend(h.prototype,f,{add:function(a){var c=this,d=[];b.isArray(a)?d=d.concat(a):"object"==typeof a&&d.push(a);for(var e=0;e<d.length;e++){var f=d[e];f.cindex=this.cindex,c.emit("add",f),c.dataList.push(f),this.cindex++}},traverse:function(a){for(var b,c=0,d=this.dataList.length;d>c;c++)b=this.dataList[c],"function"==typeof a?a(b):""},pre:function(){var a=this.dataList.length;0==this.currIndex?this.currIndex=a-1:this.currIndex-=1,this.emit("pre",this.currIndex)},next:function(){var a=this.dataList.length;this.currIndex==a-1?this.currIndex=0:this.currIndex+=1,this.emit("next",this.currIndex)},setCurrent:function(a){this.currIndex=a,this.emit("current",this.currIndex)}});var i=function(a){this.data=a,this.$el=""};b.extend(i.prototype,f,{render:function(){var a=this,c='<li class="item">						<a href="javascript:;" class="imgb">							<div class="img_warp"><span class="load"></span></div>							<div class="imgchose">								<em class="arrow"></em>							</div>						</a>					</li>';return c=c.replace(/\$\{(.+)\}/i,function(b,c){return a.data[c]}),this.$el=b(c),a.events(),this.$el},events:function(){var a=this;this.$el.on("click",function(){a.emit("click",a)}),this.renderImg()},setCurrent:function(){this.$el.addClass("item_hover")},cancelCurrent:function(){this.$el.removeClass("item_hover")},renderImg:function(){var a=this,b=this.data.smallImg;k("../src/js/resetImgSize.js","resetImgSize",function(c){c({imageUrl:b,style:"min",width:131,height:105},function(b,c){a.setImgAttr(b,c)})})},setImgAttr:function(a,c){var d=b('<img src="'+c+'"  width="'+a[0]+'" height="'+a[1]+'" class="bigPhotoImg" />');a[0]>a[1]?d.css("margin-left",-(a[0]-130)/2):d.css("margin-top",-(a[1]-130)/2),d.css("opacity",0).animate({opacity:1},200),this.$el.find(".img_warp").html(d)}});var j=function(a,b){this.imgdata=a,this.figure=b,this.boxwh={},this.imghome=this.figure.$_photoshow.find('div[node-type="img-home"]'),this.init()};b.extend(j.prototype,f,{init:function(){this.events(),this.renderImg()},events:function(){var a=this;c.on("resize",function(){a._getWH()}),a._getWH()},_getWH:function(){this.boxwh.width=this.imghome.width(),this.boxwh.height=this.imghome.height()},renderImg:function(){var a=this,b=this.imgdata.bigImg;k("../src/js/resetImgSize.js","resetImgSize",function(c){c({imageUrl:b,style:"max",width:a.boxwh.width,height:a.boxwh.height},function(b,c){a.setImgAttr(b,c)})})},setImgAttr:function(a,c){var d=b('<img src="'+c+'"  width="'+a[0]+'" height="'+a[1]+'" class="bigPhotoImg" />');this.imghome.html(d),this.setImgPos(a,d)},setImgPos:function(a,b){var c=this;a[1]<c.boxwh.height&&b.css("margin-top",(c.boxwh.height-a[1])/2),k("../src/js/rotate.js","rotate",function(d){c.rotate=d({imgObj:b,width:a[0],height:a[1],imgwarp:c.imghome,wwid:c.boxwh.width,whei:c.boxwh.height})})},zoomIn:function(){},zoomOut:function(){}});var k=function(c,d,e){a[d]?e&&e(a[d]):b.getScript(c,function(){e&&e(a[d])})};return function(a){return figureObj=new g(a)}}),function(a){var b=function(a,b,c,d){var e,f,g,h,i,j=this,k=[],l=null,m=function(){for(var a=0;a<k.length;a++)k[a].end?k.splice(a--,1):k[a]();!k.length&&n()},n=function(){clearInterval(l),l=null},o=new Image;return o.src=a,o.complete?(j.circuGet(o,b),void(c&&c.call(o))):(f=o.width,g=o.height,o.onerror=function(){d&&d.call(o),e.end=!0,o=o.onload=o.onerror=null},e=function(){h=o.width,i=o.height,(h!==f||i!==g||h*i>1024)&&(j.circuGet(o,b),e.end=!0)},e(),o.onload=function(){!e.end&&e(),c&&c.call(o),o=o.onload=o.onerror=null},void(e.end||(k.push(e),null===l&&(l=setInterval(m,40)))))};b.prototype.circuGet=function(a,b){var c,d=0,e=function(){return a.width>0&&a.height>0?void b.call(a):void(d>11||(window.console&&console.log(a," test to get img width and height!!"),c=setTimeout(e,40),d++))};e()},a.preOnloadImgSize=function(a,c,d,e){new b(a,c,d,e)}}(window),function(a,b){var c=function(a,b){d(a,b)},d=function(a,b){e("../src/js/preOnloadImgSize.js","preOnloadImgSize",function(c){c(a.imageUrl,function(){var c;"max"==a.style?c=f(a,this):"min"==a.style&&(c=g(a,this)),b&&b(c,a.imageUrl)})})},e=function(c,d,e){a[d]?e&&e(a[d]):b.getScript(c,function(){e&&e(a[d])})},f=function(a,b){var c,d,e=b.width,f=b.height;if(e<=a.width&&f<=a.height)return[e,f];var g=e/f;return e>=f?e>=a.width?(c=a.width,d=c/g):f>=a.height&&(d=a.height,c=g*d):f>=a.height?(d=a.height,c=g*d):e>=a.width&&(c=a.width,d=c/g),[c,d]},g=function(a,b){var c,d,e=b.width,f=b.height,g=a.width/a.height,h=e/f;return g>h?(c=a.width,d=c/h):(d=a.height,c=h*d),[c,d]};a.resetImgSize=c}(window,$),function(a){function b(a){for(var b in a)this[b]=a[b];this.init()}var c=function(a){var c={imgObj:"",width:0,height:0,reg:0,imgwarp:"",imgObj:""};return $.extend(c,a),new b(c)},d=b.prototype;d.init=function(){var a=this,b=a.imgwarp.find(".figure_img");b[0]&&b.remove();var c=e(this.wwid,this.whie);this.imgwarp.append(c);var d=f(this.imgObj.attr("src"),this.width,this.height),g=h(this.wwid,this.whei,this.width,this.height);this.imgObj.css({opacity:0}),c.append(d.css(g)),this.roImg=d,d.addClass("rotate"),this.rotateImg=this.rotate()},d.rotate=function(){var a=this;return i?function(b){var c,d,e=k+"transform",f=b/90;c=f%2?g(a.whei,a.wwid,a.width,a.height):g(a.wwid,a.whei,a.width,a.height);var d=h(a.wwid,a.whei,c[0],c[1]);a.roImg.css(e,"rotate("+b+"deg)"),a.roImg.css({width:c[0],height:c[1],top:d.top,left:d.left})}:j?function(b){var c,d=Math.PI/180*b,e=Math.sin(d),f=Math.cos(d),i=b/90;i%2?(nwd=g(a.whei,a.wwid,a.width,a.height),c=h(a.wwid,a.whei,nwd[1],nwd[0])):(nwd=g(a.wwid,a.whei,a.width,a.height),c=h(a.wwid,a.whei,nwd[0],nwd[1])),a.roImg.css({width:nwd[0],height:nwd[1],top:c.top,left:c.left});var j=['progid:DXImageTransform.Microsoft.Matrix(M11="',f,'", M12="',-e,'", M21="',e,'", M22="',f,'", sizingMethod="auto expand")'].join("");a.roImg.css("filter",j)}:void 0},d.clockwise=function(){this.reg+=90,this.rotateImg(this.reg)},d.anticlockwise=function(){this.reg-=90,this.rotateImg(this.reg)};var e=function(a,b){return $('<div class="figure_img"></div>').css({position:"absolute",width:a,height:b,top:0,left:0})},f=function(a,b,c){var d=$('<img src="'+a+'" />');return d.css({height:c,width:b,position:"absolute"})},g=function(a,b,c,d){var e,f;if(a>=c&&b>=d)return[c,d];var g=c/d;return c>=d?c>=a?(e=a,f=e/g):d>=b&&(f=b,e=g*f):d>=b?(f=b,e=g*f):c>=a&&(e=a,f=e/g),[e,f]},h=function(a,b,c,d){return{top:(b-d)/2,left:(a-c)/2}},i=function(){var a=document.createElement("canvas");return!(!a||!a.getContext)}(),j=function(){return void 0!==document.createElement("span").style.filter}(),k=function(){var a=navigator.userAgent;return a.indexOf("MSIE")>=0?"-ms-":a.indexOf("OPR")>=0?"-o-":a.indexOf("Firefox")>=0?"-moz-":a.indexOf("Safari")>=0?"-webkit-":a.indexOf("Chrome")>=0?"-webkit-":a.indexOf("Camino")>=0?"":""}();a.rotate=c}(window);